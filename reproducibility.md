# Reproducibility (NRR-Transfer v28 snapshot)

## Scope

This file describes the v28-aligned transfer package in this repository.
Claim-source dataset:
- `data/results/universal_3trial_results.json`

Legacy pre-v28 materials are archived in:
- `archive/legacy_pre_v28_2026-02-26/`

## Environment

- Python: 3.10+
- Libraries: `requirements.txt`
  - anthropic
  - openai
  - google-generativeai
  - matplotlib
  - numpy

## Fixed protocol settings

- Models: Claude Sonnet 4, GPT-4o-mini, Gemini 2.0 Flash
- Temperatures: 0.3 (main), 0.0 (robustness)
- Trials: 3 per condition
- Scenarios: 18 (6 domains)
- Total: 324 runs, 1,512 turns
- State update alpha: 0.4
- Max output tokens: 200

## Run commands

### A) Re-run protocol (requires API keys)

```bash
pip install -r requirements.txt

export ANTHROPIC_API_KEY="..."
export OPENAI_API_KEY="..."
export GEMINI_API_KEY="..."   # or GOOGLE_API_KEY

python3 experiments/run_universal_3trial.py \
  --scenarios-json data/universal_scenarios.json \
  --out data/results/universal_3trial_results.json \
  --trials 3 \
  --temperatures 0.3,0.0 \
  --models claude,gpt,gemini \
  --max-tokens 200 \
  --alpha 0.4
```

### B) Regenerate manuscript figures from finalized results

```bash
python3 figures/generate_figures_from_results.py
```

This regenerates:
- `figures/paper5_fig2_all_domains.png`
- `figures/paper5_fig4_operator_heatmap.png`

If you want manuscript-folder copies:

```bash
cp figures/paper5_fig2_all_domains.png manuscript/paper5_fig2_all_domains.png
cp figures/paper5_fig4_operator_heatmap.png manuscript/paper5_fig4_operator_heatmap.png
```

## Artifact map

- Main manuscript source:
  - `manuscript/paper5-nrr-transfer-v28.tex`
- Main manuscript PDF:
  - `manuscript/paper5-nrr-transfer-v28.pdf`
- Figure 1 (architecture flow):
  - `manuscript/paper5_fig1_horizontal_v2.png` (static manuscript figure)
- Figure 2 (token consumption):
  - generated by `figures/generate_figures_from_results.py`
  - output: `figures/paper5_fig2_all_domains.png`
- Figure 3 (structural similarity):
  - `manuscript/paper5_fig3_structural_similarity.png` (static manuscript figure)
- Figure 4 (operator heatmap):
  - generated by `figures/generate_figures_from_results.py`
  - output: `figures/paper5_fig4_operator_heatmap.png`

## Known notes

- PNG files may differ bit-for-bit across environments while remaining visually equivalent.
- API-based reruns can produce small token-count variation due to provider-side changes over time.
- The included `data/results/universal_3trial_results.json` is the claim-source snapshot for manuscript v28.
